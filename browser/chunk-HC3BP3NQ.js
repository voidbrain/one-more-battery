import{m as b,y as d}from"./chunk-FBZGSWPW.js";import{a as n,b as o,i as u}from"./chunk-C4LRBQUY.js";var m=class m{BATTERIES_KEY="angular-batteries";BRANDS_KEY="angular-brands";SERIES_KEY="angular-series";TYPES_KEY="angular-types";USAGE_RECORDS_KEY="angular-usage-records";RESISTANCE_RECORDS_KEY="angular-resistance-records";SETTINGS_KEY="angular-settings";batteries=d([]);brands=d([]);series=d([]);types=d([]);usageRecords=d([]);resistanceRecords=d([]);settings=d([]);nextBatteryId=d(1);nextBrandId=d(1);nextSeriesId=d(1);nextTypeId=d(1);nextUsageRecordId=d(1);nextResistanceRecordId=d(1);constructor(){this.initializeDatabase()}initializeDatabase(){this.loadFromStorage(),console.log("Database initialized successfully")}loadFromStorage(){try{let t=localStorage.getItem(this.BATTERIES_KEY);if(t){let i=JSON.parse(t);this.batteries.set(i);let c=i.length>0?Math.max(...i.map(g=>g.id)):0;this.nextBatteryId.set(c+1)}let e=localStorage.getItem(this.BRANDS_KEY);if(e){let i=JSON.parse(e);this.brands.set(i);let c=i.length>0?Math.max(...i.map(g=>g.id)):0;this.nextBrandId.set(c+1)}let s=localStorage.getItem(this.SERIES_KEY);if(s){let i=JSON.parse(s);this.series.set(i);let c=i.length>0?Math.max(...i.map(g=>g.id)):0;this.nextSeriesId.set(c+1)}let r=localStorage.getItem(this.TYPES_KEY);if(r){let i=JSON.parse(r);this.types.set(i);let c=i.length>0?Math.max(...i.map(g=>g.id)):0;this.nextTypeId.set(c+1)}let a=localStorage.getItem(this.USAGE_RECORDS_KEY);if(a){let i=JSON.parse(a);this.usageRecords.set(i);let c=i.length>0?Math.max(...i.map(g=>g.id)):0;this.nextUsageRecordId.set(c+1)}let l=localStorage.getItem(this.RESISTANCE_RECORDS_KEY);if(l){let i=JSON.parse(l);this.resistanceRecords.set(i);let c=i.length>0?Math.max(...i.map(g=>g.id)):0;this.nextResistanceRecordId.set(c+1)}let h=localStorage.getItem(this.SETTINGS_KEY);h&&this.settings.set(JSON.parse(h))}catch(t){console.error("Error loading data from storage:",t)}}saveToStorage(){try{localStorage.setItem(this.BATTERIES_KEY,JSON.stringify(this.batteries())),localStorage.setItem(this.BRANDS_KEY,JSON.stringify(this.brands())),localStorage.setItem(this.SERIES_KEY,JSON.stringify(this.series())),localStorage.setItem(this.TYPES_KEY,JSON.stringify(this.types())),localStorage.setItem(this.USAGE_RECORDS_KEY,JSON.stringify(this.usageRecords())),localStorage.setItem(this.RESISTANCE_RECORDS_KEY,JSON.stringify(this.resistanceRecords())),localStorage.setItem(this.SETTINGS_KEY,JSON.stringify(this.settings()))}catch(t){console.error("Error saving data to storage:",t)}}async insertBattery(t){let e=o(n({},t),{id:this.nextBatteryId()}),s=this.batteries();return this.batteries.set([...s,e]),this.nextBatteryId.set(this.nextBatteryId()+1),this.saveToStorage(),e.id}async getBatteries(){return this.batteries().map(e=>o(n({},e),{brand:this.brands().find(s=>s.id===e.brandId),series:this.series().find(s=>s.id===e.seriesId),type:this.types().find(s=>s.id===e.typeId)}))}async updateBattery(t,e){let r=this.batteries().map(a=>a.id===t?n(n({},a),e):a);this.batteries.set(r),this.saveToStorage()}async deleteBattery(t){let s=this.batteries().filter(r=>r.id!==t);this.batteries.set(s),this.saveToStorage()}async insertBrand(t){let e={id:this.nextBrandId(),label:t.trim(),deleted:0,enabled:1},s=this.brands();return this.brands.set([...s,e]),this.nextBrandId.set(this.nextBrandId()+1),this.saveToStorage(),e.id}async getBrands(){return this.brands().filter(t=>t.deleted===0)}async updateBrand(t,e){let r=this.brands().map(a=>a.id===t?o(n({},a),{label:e.trim()}):a);this.brands.set(r),this.saveToStorage()}async deleteBrand(t){let s=this.brands().map(r=>r.id===t?o(n({},r),{deleted:1}):r);this.brands.set(s),this.saveToStorage()}async insertSeries(t,e){let s={id:this.nextSeriesId(),label:t.trim(),color:e,deleted:0,enabled:1},r=this.series();return this.series.set([...r,s]),this.nextSeriesId.set(this.nextSeriesId()+1),this.saveToStorage(),s.id}async getSeries(){return this.series().filter(t=>t.deleted===0)}async updateSeries(t,e,s){let a=this.series().map(l=>l.id===t?o(n({},l),{label:e.trim(),color:s}):l);this.series.set(a),this.saveToStorage()}async deleteSeries(t){let s=this.series().map(r=>r.id===t?o(n({},r),{deleted:1}):r);this.series.set(s),this.saveToStorage()}async insertType(t){let e={id:this.nextTypeId(),label:t.trim(),deleted:0,enabled:1},s=this.types();return this.types.set([...s,e]),this.nextTypeId.set(this.nextTypeId()+1),this.saveToStorage(),e.id}async getTypes(){return this.types().filter(t=>t.deleted===0)}async updateType(t,e){let r=this.types().map(a=>a.id===t?o(n({},a),{label:e.trim()}):a);this.types.set(r),this.saveToStorage()}async deleteType(t){let s=this.types().map(r=>r.id===t?o(n({},r),{deleted:1}):r);this.types.set(s),this.saveToStorage()}async insertUsageRecord(t){let e=o(n({},t),{id:this.nextUsageRecordId()}),s=this.usageRecords();return this.usageRecords.set([...s,e]),this.nextUsageRecordId.set(this.nextUsageRecordId()+1),this.saveToStorage(),e.id}async getUsageRecords(t){let e=this.usageRecords().filter(s=>s.deleted===0);return t?e.filter(s=>s.idBattery===t):e}async insertResistanceRecord(t){let e=o(n({},t),{id:this.nextResistanceRecordId()}),s=this.resistanceRecords();return this.resistanceRecords.set([...s,e]),this.nextResistanceRecordId.set(this.nextResistanceRecordId()+1),this.saveToStorage(),e.id}async getResistanceRecords(t){let e=this.resistanceRecords().filter(s=>s.deleted===0);return t?e.filter(s=>s.idBattery===t):e}async insertSettings(t,e=30,s="default",r="en"){let a={id:1,showDismissedBatteries:t,batteryAlertDays:e,styleTheme:s,language:r};return this.settings.set([a]),this.saveToStorage(),a.id}async getSettings(){return this.settings()}async updateSettings(t,e,s,r){let a=this.settings().map(l=>n(n(n(o(n({},l),{showDismissedBatteries:t}),e!==void 0&&{batteryAlertDays:e}),s!==void 0&&{styleTheme:s}),r!==void 0&&{language:r}));this.settings.set(a),this.saveToStorage()}async fillWithMockData(){this._fillWithMockData(),this.saveToStorage()}async resetDatabase(){localStorage.removeItem(this.BATTERIES_KEY),localStorage.removeItem(this.BRANDS_KEY),localStorage.removeItem(this.SERIES_KEY),localStorage.removeItem(this.TYPES_KEY),localStorage.removeItem(this.USAGE_RECORDS_KEY),localStorage.removeItem(this.RESISTANCE_RECORDS_KEY),localStorage.removeItem(this.SETTINGS_KEY),this.initializeDatabase()}_fillWithMockData(){this.insertBrand("Tattu"),this.insertBrand("Gaoneng"),this.insertBrand("BetaFPV"),this.insertSeries("Yellow","#c4c41cff"),this.insertSeries("Red","#c61f1fff"),this.insertSeries("Blue","#252edaff"),this.insertType("LiPo"),this.insertType("LiHV"),this.insertBattery({brandId:1,seriesId:1,typeId:1,cellsNumber:6,date:"2025-11-13",label:"1",mA:1400,model:"R-Line",deleted:0,enabled:1}),this.insertBattery({brandId:1,seriesId:1,typeId:1,cellsNumber:6,date:"2025-11-13",label:"2",mA:1400,model:"R-Line",deleted:0,enabled:1}),this.insertUsageRecord({idBattery:1,date:"2025-11-13",status:1,deleted:0,enabled:1}),this.insertUsageRecord({idBattery:1,date:"2025-11-11",status:3,deleted:0,enabled:1}),this.insertUsageRecord({idBattery:1,date:"2025-11-11",status:1,deleted:0,enabled:1}),this.insertUsageRecord({idBattery:1,date:"2025-11-12",status:2,deleted:0,enabled:1}),this.insertUsageRecord({idBattery:1,date:"2025-11-13",status:3,deleted:0,enabled:1}),this.insertUsageRecord({idBattery:1,date:"2025-11-13",status:1,deleted:0,enabled:1}),this.insertUsageRecord({idBattery:1,date:"2025-11-13",status:2,deleted:0,enabled:1}),this.insertResistanceRecord({idBattery:1,date:"2025-10-13",resistance_values:[12.5,12.7,12.6,12.8,12.9,13],deleted:0,enabled:1}),this.insertResistanceRecord({idBattery:1,date:"2025-11-13",resistance_values:[13,13.2,13.1,13.3,13.4,13.5],deleted:0,enabled:1}),this.insertSettings(!1)}async execute(t){return console.log("Executing SQL:",t),[]}exportDatabase(){return JSON.stringify({batteries:this.batteries(),brands:this.brands(),series:this.series(),types:this.types(),usageRecords:this.usageRecords(),resistanceRecords:this.resistanceRecords(),settings:this.settings()})}importDatabase(t){try{let e=JSON.parse(t);e.batteries&&this.batteries.set(e.batteries),e.brands&&this.brands.set(e.brands),e.series&&this.series.set(e.series),e.types&&this.types.set(e.types),e.usageRecords&&this.usageRecords.set(e.usageRecords),e.resistanceRecords&&this.resistanceRecords.set(e.resistanceRecords),e.settings&&this.settings.set(e.settings),this.saveToStorage()}catch(e){console.error("Error importing database:",e)}}close(){}};u(m,"\u0275fac",function(e){return new(e||m)}),u(m,"\u0275prov",b({token:m,factory:m.\u0275fac,providedIn:"root"}));var p=m;export{p as a};
